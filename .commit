#!/bin/bash

# /commit ã‚³ãƒãƒ³ãƒ‰ - ç¾åœ¨ã®å¤‰æ›´ã‚’æ©Ÿèƒ½ã”ã¨ã«è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ

echo "ğŸš€ Starting feature-based commits..."

# git statusã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª
git_status=$(git status --porcelain)

if [ -z "$git_status" ]; then
    echo "âœ… No changes to commit"
    exit 0
fi

echo "ğŸ“ Current changes:"
git status --short

# å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
declare -A file_groups

# ãƒ¢ãƒ‡ãƒ«é–¢é€£ã®å¤‰æ›´
model_files=""
ui_component_files=""
screen_files=""
dialog_files=""
config_files=""
other_files=""

while IFS= read -r line; do
    status="${line:0:2}"
    file="${line:3}"
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦åˆ†é¡
    if [[ "$file" == *"/model/"* ]]; then
        model_files="$model_files $file"
    elif [[ "$file" == *"/components/"*Dialog* ]]; then
        dialog_files="$dialog_files $file"
    elif [[ "$file" == *"/components/"* ]]; then
        ui_component_files="$ui_component_files $file"
    elif [[ "$file" == *"/screens/"* ]]; then
        screen_files="$screen_files $file"
    elif [[ "$file" == *.properties ]] || [[ "$file" == *.gradle* ]] || [[ "$file" == *.toml ]]; then
        config_files="$config_files $file"
    else
        other_files="$other_files $file"
    fi
done <<< "$git_status"

commit_count=0

# ãƒ¢ãƒ‡ãƒ«å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$model_files" ]; then
    echo ""
    echo "ğŸ“¦ Committing model changes..."
    for file in $model_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
feat: update domain and UI models

- Enhanced model structures for better data handling
- Improved type safety and nullable field handling

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

# ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$dialog_files" ]; then
    echo ""
    echo "ğŸ’¬ Committing dialog component changes..."
    for file in $dialog_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
feat: improve dialog components

- Enhanced dialog layouts and user experience
- Better form validation and input handling

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

# UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$ui_component_files" ]; then
    echo ""
    echo "ğŸ¨ Committing UI component changes..."
    for file in $ui_component_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
feat: update UI components

- Improved component styling and layout
- Enhanced user interaction feedback

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$screen_files" ]; then
    echo ""
    echo "ğŸ“± Committing screen changes..."
    for file in $screen_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
feat: update screen implementations

- Enhanced screen layouts and navigation
- Improved state management and data flow

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$config_files" ]; then
    echo ""
    echo "âš™ï¸ Committing configuration changes..."
    for file in $config_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
chore: update project configuration

- Modified build settings and dependencies
- Updated project properties

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

# ãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$other_files" ]; then
    echo ""
    echo "ğŸ“„ Committing other changes..."
    for file in $other_files; do
        git add "$file"
    done
    
    git commit -m "$(cat <<'EOF'
chore: miscellaneous updates

- Various improvements and fixes

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
    )"
    ((commit_count++))
fi

echo ""
echo "âœ… Completed $commit_count commits"
echo ""
echo "ğŸ“œ Recent commits:"
git log --oneline -"$commit_count"